<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Functions to flag/exclude models — flag_model_residual • CompMetaboTools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Functions to flag/exclude models — flag_model_residual" />
<meta property="og:description" content="The functions listed on this help page (flag_*) allow to flag/identify
potentially problematic model fits. The function were designed to be used
with the models estimating an injection-order-dependent signal drift seen
in LC-MS based untargeted metabolomics data. Such models can be fit with the
rowFitModel function of the xcms package. Functions are expected to
return TRUE for potentially problematic model fits and FALSE otherwise.
The functions are:
flag_model_residual: test whether the difference between the difference
between the 25 and 75% quantile of residuals is larger than the user
defined value diff_residual. This function identifies model fits with
on average large deviations of the individual data points from the fitted
line.
flag_model_mean_residual: tests if the mean of the absolute residuals
is larger than the provided value.
flag_model_inj_range: tests if values on which the model was fitted
spans a minimum required injection index range. This requires x being
a model of the type y ~ inj_idx.
flag_model_cat_count: tests if the number of replicated measurents
(categories) for a categorical variable (e.g. batch) are larger than
min_count.
flag_model_coef_count: tests if the number of estimated coefficients
matches the expected number. This is useful/required for linear models
aimed to adjust a batch effect, but for which a coefficient was not
estimated for each batch (=level of the categorical variable representing
the batch). This could happen if only missing values were present for the
respective batch.

" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CompMetaboTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/LC-MS-feature-grouping.html">LC-MS feature grouping</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/EuracBiomedicalResearch/CompMetaboTools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Functions to flag/exclude models</h1>
    <small class="dont-index">Source: <a href='https://github.com/EuracBiomedicalResearch/CompMetaboTools/blob/master/R/model_flagging.R'><code>R/model_flagging.R</code></a></small>
    <div class="hidden name"><code>model-flagging.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The functions listed on this help page (<code>flag_*</code>) allow to flag/identify
potentially problematic model fits. The function were designed to be used
with the models estimating an injection-order-dependent signal drift seen
in LC-MS based untargeted metabolomics data. Such models can be fit with the
<code>rowFitModel</code> function of the <code>xcms</code> package. Functions are expected to
return <code>TRUE</code> for potentially problematic model fits and <code>FALSE</code> otherwise.</p>
<p>The functions are:</p><ul>
<li><p><code>flag_model_residual</code>: test whether the difference between the difference
between the 25 and 75% quantile of residuals is larger than the user
defined value <code>diff_residual</code>. This function identifies model fits with
on average large deviations of the individual data points from the fitted
line.</p></li>
<li><p><code>flag_model_mean_residual</code>: tests if the <code>mean</code> of the absolute residuals
is larger than the provided value.</p></li>
<li><p><code>flag_model_inj_range</code>: tests if values on which the model was fitted
spans a minimum required injection index range. This requires <code>x</code> being
a model of the type <code>y ~ inj_idx</code>.</p></li>
<li><p><code>flag_model_cat_count</code>: tests if the number of replicated measurents
(categories) for a categorical variable (e.g. batch) are larger than
<code>min_count</code>.</p></li>
<li><p><code>flag_model_coef_count</code>: tests if the number of estimated coefficients
matches the expected number. This is useful/required for linear models
aimed to adjust a batch effect, but for which a coefficient was not
estimated for each batch (=level of the categorical variable representing
the batch). This could happen if only missing values were present for the
respective batch.</p></li>
</ul>

    </div>

    <pre class="usage"><span class='fu'>flag_model_residual</span><span class='op'>(</span><span class='va'>x</span>, diff_residual <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='fu'>flag_model_mean_residual</span><span class='op'>(</span><span class='va'>x</span>, cut_off <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>

<span class='fu'>flag_model_inj_range</span><span class='op'>(</span><span class='va'>x</span>, min_range <span class='op'>=</span> <span class='fl'>1</span>, column <span class='op'>=</span> <span class='st'>"inj_idx"</span><span class='op'>)</span>

<span class='fu'>flag_model_cat_count</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>variable</span>, min_count <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>

<span class='fu'>flag_model_coef_count</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>n_coef</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a linear model object such as generated by <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> or
<code><a href='https://rdrr.io/pkg/robustbase/man/lmrob.html'>robustbase::lmrob()</a></code>.</p></td>
    </tr>
    <tr>
      <th>diff_residual</th>
      <td><p>for <code>flag_model_residual</code>: <code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the
cut-off to flag models with large residuals. <code>TRUE</code> is reported for all
models with a difference between the 25 and 75 percent percentile of
residuals larger than this value.</p></td>
    </tr>
    <tr>
      <th>cut_off</th>
      <td><p>for <code>flag_model_mean_residual</code>: <code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the
cut-off to flag models with large average residuals.</p></td>
    </tr>
    <tr>
      <th>min_range</th>
      <td><p>for <code>flag_model_inj_range</code>: <code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code> defining the
minimum range. This is an absolute value, not a percentage. Means, the
function compares the <code><a href='https://rdrr.io/r/base/diff.html'>diff(range(x$x[, column]))</a></code> with <code>min_range</code> and
flags models that don't fit that criteria (i.e. have a smaller range).</p></td>
    </tr>
    <tr>
      <th>column</th>
      <td><p>for <code>flag_model_inj_range</code>: <code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> specifying the
column containing the injection index.</p></td>
    </tr>
    <tr>
      <th>variable</th>
      <td><p>for <code>flag_model_cat_count</code>: <code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> with the name of
the categorical value. Should be one of <code><a href='https://rdrr.io/r/base/colnames.html'>colnames(x$model)</a></code>.</p></td>
    </tr>
    <tr>
      <th>min_count</th>
      <td><p>for <code>flag_model_cat_count</code>: <code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code> with the minimum
required number of values within each category.</p></td>
    </tr>
    <tr>
      <th>n_coef</th>
      <td><p>for <code>flag_model_coef_count</code>: <code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code> with the expected
number of coefficients.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>: <code>TRUE</code> if model fit is potentially problematic and
<code>FALSE</code> otherwise or <code>NA</code> if no model provided.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Johannes Rainer</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Johannes Rainer, Mar Garcia-Aloy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


